"use strict";
(self["webpackChunk"] = self["webpackChunk"] || []).push([["assets_js_addVoiture_js"],{

/***/ "./assets/js/addVoiture.js":
/*!*********************************!*\
  !*** ./assets/js/addVoiture.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   addVoiture: () => (/* binding */ addVoiture),
/* harmony export */   initAddVoitureFormBtns: () => (/* binding */ initAddVoitureFormBtns),
/* harmony export */   initUserVoitureBtns: () => (/* binding */ initUserVoitureBtns),
/* harmony export */   showAddVoitureForm: () => (/* binding */ showAddVoitureForm)
/* harmony export */ });
/* harmony import */ var _app__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../app */ "./assets/app.js");


function addVoiture(previousElementId) {
  var currentCarId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var fetchPath = currentCarId ? "/add-voiture?id=".concat(encodeURIComponent(currentCarId)) : "/add-voiture";
  fetch(fetchPath, {
    method: 'POST',
    headers: {
      'X-Requested-With': 'XMLHttpRequest' // important pour indiquer une requête AJAX
    }
  }).then(function (response) {
    return response.json();
  }).then(function (data) {
    // data.html contient ton formulaire rendu
    if (previousElementId) {
      document.getElementById(previousElementId).style.display = "none";
      var container = document.getElementById('body-content');
      if (container) {
        container.insertAdjacentHTML('beforeend', data.html);
        initMarqueInputInteraction();
        initAddVoitureFormBtns(previousElementId, currentCarId);
        if (currentCarId) {
          var currentVoiture = document.getElementById(currentCarId);
          document.getElementById('add_voiture_marque').value = currentVoiture.querySelector('.marque').innerHTML;
        }
      } else {
        console.error('Le container cible n\'existe pas : body-content');
      }
    }
  })["catch"](function (error) {
    return console.error('Erreur:', error);
  });
}
function initMarqueInputInteraction() {
  var marqueInput = document.getElementById('add_voiture_marque');
  var suggestionsBox = document.getElementById('suggestions-marque-box');
  var brands = JSON.parse(marqueInput.dataset.marqueList);
  var selected = false;
  marqueInput.addEventListener('input', function () {
    var query = this.value.toLowerCase();
    var filtered = brands.filter(function (brand) {
      return brand.toLowerCase().includes(query);
    }).slice(0, 10);
    suggestionsBox.innerHTML = '';
    selected = false;
    if (query !== "") {
      filtered.forEach(function (brand) {
        var li = document.createElement('li');
        li.textContent = brand;
        li.style.cursor = 'pointer';
        li.onclick = function () {
          marqueInput.value = brand;
          selected = true;
          suggestionsBox.innerHTML = '';
        };
        suggestionsBox.appendChild(li);
      });
    }
  });

  // marqueInput.form.addEventListener('submit', function (e) {
  //     if (!brands.includes(marqueInput.value)) {
  //         e.preventDefault();
  //         alert("Veuillez sélectionner une marque valide dans la liste.");
  //     }
  // });
}
function initAddVoitureFormBtns(divToShowId, currentCarId) {
  var currentDiv = document.getElementById('add-voiture-section');
  var addVoitureForm = document.getElementById("add-voiture-form");
  var addVoitureFormInputs = addVoitureForm.querySelectorAll('input, select, textarea');
  (0,_app__WEBPACK_IMPORTED_MODULE_0__.checkInputs)(addVoitureForm);
  addVoitureFormInputs.forEach(function (input) {
    input.addEventListener('input', function () {
      return (0,_app__WEBPACK_IMPORTED_MODULE_0__.checkInputs)(addVoitureForm);
    });
  });
  var backBtn = document.getElementById('add-voiture-back-btn');
  backBtn.addEventListener('click', function (e) {
    document.getElementById('add-voiture-section').style.display = "none";
    document.getElementById(divToShowId).style.display = "flex";
  });
  var immatriculationInput = document.getElementById('add_voiture_immatriculation');
  immatriculationInput.addEventListener('keydown', function (e) {
    if (e.key === ' ') {
      e.preventDefault();
    }
  });
  var selectColorInput = document.getElementById('add_voiture_couleur');
  var colorIndicator = document.getElementById('color-view');
  var colorMap = {
    'Blanc': '#ffffff',
    'Noir': '#000000',
    'Gris foncé': '#555555',
    'Gris clair': '#d3d3d3',
    'Rouge': '#ff0000',
    'Bleu': '#0000ff',
    'Vert': '#008000',
    'Jaune': '#ffff00',
    'Orange': '#ffa500',
    'Marron': '#8b4513',
    'Violet': '#800080',
    'Beige': '#f5f5dc',
    'Rose': '#ffc0cb'
  };
  function updateColor() {
    var selected = selectColorInput.value;
    if (selected === '') {
      //style placeholder
      selectColorInput.classList.add('select-color-placeholder');
    } else {
      selectColorInput.classList.remove('select-color-placeholder');
    }

    //style color indicator
    colorIndicator.style.backgroundColor = colorMap[selected] || 'transparent';
  }
  selectColorInput.addEventListener('change', updateColor);
  updateColor(); // initialise au chargement

  var placesInput = document.getElementById('add_voiture_places');
  placesInput.addEventListener('input', function () {
    var maxSeats = 9;
    var value = parseInt(this.value, 10);
    if (isNaN(value)) return;
    if (value < 2) {
      placesInput.value = 2;
    } else if (value > maxSeats) {
      placesInput.value = maxSeats;
    }
  });
  var showDeleteVoiturePopupBtn = document.getElementById('show-delete-voiture-popup');
  if (showDeleteVoiturePopupBtn) {
    var deleteVoiturePopup = document.getElementById('delete-voiture-popup');
    var deleteVoitureBtn = document.getElementById('delete-voiture');
    var _addVoitureForm = document.getElementById("add-voiture-form");
    showDeleteVoiturePopupBtn.addEventListener('click', function () {
      (0,_app__WEBPACK_IMPORTED_MODULE_0__.showPopup)(deleteVoiturePopup, 'flex');
    });
    deleteVoitureBtn.addEventListener('click', function (e) {
      e.preventDefault();
      fetch('delete-voiture/' + currentCarId, {
        method: 'POST',
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      }).then(function (response) {
        if (!response.ok) {
          throw new Error('Erreur HTTP : ' + response.status);
        }
        return response.json();
      }).then(function (data) {
        if (data.status && data.status == "success") {
          document.getElementById(divToShowId).style.display = "flex";
          document.getElementById(currentCarId).remove();
          currentDiv.style.display = "none";
          (0,_app__WEBPACK_IMPORTED_MODULE_0__.showSuccessAlert)('Voiture supprimé avec succès');
          initUserVoitureBtns(divToShowId, currentCarId);
        } else {
          (0,_app__WEBPACK_IMPORTED_MODULE_0__.treatFormAlert)(_addVoitureForm, '', data);
          (0,_app__WEBPACK_IMPORTED_MODULE_0__.hidePopup)(deleteVoiturePopup);
        }
      });
    });
  }
  var submitAddVoitureFormBtn = document.getElementById('add-voiture-submit');
  submitAddVoitureFormBtn.addEventListener('click', function (e) {
    e.preventDefault();
    treatAddVoitureForm(divToShowId, currentCarId);
  });
}
function treatAddVoitureForm(divToShowId) {
  var currentCarId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var form = document.getElementById("add-voiture-form");
  var formData = new FormData(form);
  var currentDiv = document.getElementById('add-voiture-section');
  var fetchPath = currentCarId ? "/add-voiture?id=".concat(encodeURIComponent(currentCarId)) : "/add-voiture";
  fetch(fetchPath, {
    method: 'POST',
    body: formData,
    headers: {
      'X-Requested-With': 'XMLHttpRequest'
    }
  }).then(function (response) {
    if (!response.ok) {
      throw new Error('Erreur HTTP : ' + response.status);
    }
    return response.json();
  }).then(function (data) {
    if (data.status && data.status == "success") {
      document.getElementById(divToShowId).style.display = "flex";
      currentDiv.style.display = "none";
      var voituresListDiv = document.getElementById('user-voitures');
      if (!currentCarId) {
        var newVoitureDiv = document.createElement('div');
        newVoitureDiv.classList.add("voiture-card");
        newVoitureDiv.id = data.voiture.id;
        newVoitureDiv.innerHTML = "\n                    <span class=\"surnom\">".concat(data.voiture.surnom, "</span>\n                    <div>\n                        <span class=\"marque\">").concat(data.voiture.marque, "</span>\n                        <span class=\"modele\">").concat(data.voiture.modele, "</span>\n                        <span class=\"is-electric\">").concat(data.voiture.isElectric ? 'Electrique' : 'Thermique', "</span>\n                        <span class=\"places fw-bold\">").concat(data.voiture.places, " place").concat(data.voiture.places > 1 ? 's' : '', "</span>\n                    </div>\n                ");
        voituresListDiv.insertAdjacentElement('afterbegin', newVoitureDiv);
        (0,_app__WEBPACK_IMPORTED_MODULE_0__.showSuccessAlert)('Voiture ajouté avec succès');
      } else {
        var currentVoitureDiv = document.getElementById(currentCarId);
        currentVoitureDiv.innerHTML = "\n                    <span class=\"surnom\">".concat(data.voiture.surnom, "</span>\n                    <div>\n                        <span class=\"marque\">").concat(data.voiture.marque, "</span>\n                        <span class=\"modele\">").concat(data.voiture.modele, "</span>\n                        <span class=\"is-electric\">").concat(data.voiture.isElectric ? 'Electrique' : 'Thermique', "</span>\n                        <span class=\"places fw-bold\">").concat(data.voiture.places, " place").concat(data.voiture.places > 1 ? 's' : '', "</span>\n                    </div>\n                ");
        (0,_app__WEBPACK_IMPORTED_MODULE_0__.showSuccessAlert)('Voiture modifié avec succès');
      }
      initUserVoitureBtns(divToShowId, currentCarId);

      //lignes de code applicable a la page devenir chauffeur
      var hasVoitureInput = document.getElementById('devenir_chauffeur_hasVoiture');
      var voitureCards = document.querySelectorAll('.voiture-card');
      if (hasVoitureInput) {
        if (voitureCards.length > 0) {
          hasVoitureInput.checked = true;
          hasVoitureInput.dispatchEvent(new Event('input', {
            bubbles: true
          }));
        }
      }

      //appliquer fonction JS pour selection
    } else {
      var currentParentDiv = document.getElementById('body-content');
      currentDiv.remove();
      currentParentDiv.insertAdjacentHTML('beforeend', data.html);
      initAddVoitureFormBtns(divToShowId, currentCarId);
      initMarqueInputInteraction();
    }
  });
}
function initUserVoitureBtns(divToShowId) {
  var currentCarId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var userVoituresBtns = document.querySelectorAll(".voiture-card");
  var voitureInput = document.querySelector('.voiture-input');
  if (!currentCarId) {
    userVoituresBtns.forEach(function (voitureBtn) {
      if (voitureBtn.dataset.listenerAttached === 'true') {
        return; // Ne rien faire si déjà attaché
      }
      voitureBtn.addEventListener('click', function (e) {
        e.preventDefault();
        var currentVoitureId = voitureBtn.id;
        userVoituresBtns.forEach(function (voitureBtn) {
          return voitureBtn.classList.remove('selected');
        });
        this.classList.add('selected');
        voitureInput.value = currentVoitureId;
        //declenche event sur voiture manuellement
        var event = new Event("input", {
          bubbles: true
        });
        voitureInput.dispatchEvent(event);
        if (!window.location.href.includes('publier-trajet')) {
          showAddVoitureForm(divToShowId, voitureBtn.id);
        }
        voitureBtn.dataset.listenerAttached = 'true';
      });
    });
  }
}
function showAddVoitureForm(divToHideId) {
  var currentCarId = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;
  var addVoitureDiv = document.getElementById('add-voiture-section');
  if (addVoitureDiv) {
    addVoitureDiv.remove();
  }
  addVoiture(divToHideId, currentCarId);
}

/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YnBhY2s6Ly8vLi9hc3NldHMvanMvYWRkVm9pdHVyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2NoZWNrSW5wdXRzLCBoaWRlUG9wdXAsIHNob3dFcnJvcnMsIHNob3dQb3B1cCwgdHJlYXRGb3JtQWxlcnR9IGZyb20gJy4uL2FwcCc7XG5pbXBvcnQge3Nob3dTdWNjZXNzQWxlcnR9IGZyb20gJy4uL2FwcCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRWb2l0dXJlKHByZXZpb3VzRWxlbWVudElkLCBjdXJyZW50Q2FySWQgPSBudWxsKSB7XG4gICAgY29uc3QgZmV0Y2hQYXRoID0gY3VycmVudENhcklkXG4gICAgICAgID8gYC9hZGQtdm9pdHVyZT9pZD0ke2VuY29kZVVSSUNvbXBvbmVudChjdXJyZW50Q2FySWQpfWBcbiAgICAgICAgOiBcIi9hZGQtdm9pdHVyZVwiO1xuICAgIFxuICAgIGZldGNoKGZldGNoUGF0aCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ1gtUmVxdWVzdGVkLVdpdGgnOiAnWE1MSHR0cFJlcXVlc3QnIC8vIGltcG9ydGFudCBwb3VyIGluZGlxdWVyIHVuZSByZXF1w6p0ZSBBSkFYXG4gICAgICAgIH1cbiAgICB9KVxuICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgLy8gZGF0YS5odG1sIGNvbnRpZW50IHRvbiBmb3JtdWxhaXJlIHJlbmR1XG4gICAgICAgIGlmIChwcmV2aW91c0VsZW1lbnRJZCkge1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocHJldmlvdXNFbGVtZW50SWQpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib2R5LWNvbnRlbnQnKTtcblxuICAgICAgICAgICAgaWYgKGNvbnRhaW5lcikge1xuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsZGF0YS5odG1sKTtcblxuICAgICAgICAgICAgICAgIGluaXRNYXJxdWVJbnB1dEludGVyYWN0aW9uKCk7XG4gICAgICAgICAgICAgICAgaW5pdEFkZFZvaXR1cmVGb3JtQnRucyhwcmV2aW91c0VsZW1lbnRJZCwgY3VycmVudENhcklkKTtcblxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2FySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFZvaXR1cmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdXJyZW50Q2FySWQpO1xuXG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRfdm9pdHVyZV9tYXJxdWUnKS52YWx1ZSA9IGN1cnJlbnRWb2l0dXJlLnF1ZXJ5U2VsZWN0b3IoJy5tYXJxdWUnKS5pbm5lckhUTUw7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTGUgY29udGFpbmVyIGNpYmxlIG5cXCdleGlzdGUgcGFzIDogYm9keS1jb250ZW50Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKCdFcnJldXI6JywgZXJyb3IpKTtcbn1cblxuZnVuY3Rpb24gaW5pdE1hcnF1ZUlucHV0SW50ZXJhY3Rpb24oKSB7XG4gIFxuICAgIGNvbnN0IG1hcnF1ZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZF92b2l0dXJlX21hcnF1ZScpO1xuICAgIGNvbnN0IHN1Z2dlc3Rpb25zQm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N1Z2dlc3Rpb25zLW1hcnF1ZS1ib3gnKTtcbiAgICBjb25zdCBicmFuZHMgPSBKU09OLnBhcnNlKG1hcnF1ZUlucHV0LmRhdGFzZXQubWFycXVlTGlzdCk7XG4gICAgbGV0IHNlbGVjdGVkID0gZmFsc2U7XG4gIFxuICAgIG1hcnF1ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBxdWVyeSA9IHRoaXMudmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgZmlsdGVyZWQgPSBicmFuZHMuZmlsdGVyKGJyYW5kID0+IGJyYW5kLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMocXVlcnkpKS5zbGljZSgwLCAxMCk7XG4gIFxuICAgICAgICBzdWdnZXN0aW9uc0JveC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIGlmIChxdWVyeSAhPT0gXCJcIikge1xuICAgICAgICAgICAgZmlsdGVyZWQuZm9yRWFjaChicmFuZCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgICAgICAgICAgIGxpLnRleHRDb250ZW50ID0gYnJhbmQ7XG4gICAgICAgICAgICAgICAgbGkuc3R5bGUuY3Vyc29yID0gJ3BvaW50ZXInO1xuICAgICAgICAgICAgICAgIGxpLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG1hcnF1ZUlucHV0LnZhbHVlID0gYnJhbmQ7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnNCb3guaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBzdWdnZXN0aW9uc0JveC5hcHBlbmRDaGlsZChsaSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KTtcbiAgXG4gICAgLy8gbWFycXVlSW5wdXQuZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgIC8vICAgICBpZiAoIWJyYW5kcy5pbmNsdWRlcyhtYXJxdWVJbnB1dC52YWx1ZSkpIHtcbiAgICAvLyAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAvLyAgICAgICAgIGFsZXJ0KFwiVmV1aWxsZXogc8OpbGVjdGlvbm5lciB1bmUgbWFycXVlIHZhbGlkZSBkYW5zIGxhIGxpc3RlLlwiKTtcbiAgICAvLyAgICAgfVxuICAgIC8vIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdEFkZFZvaXR1cmVGb3JtQnRucyhkaXZUb1Nob3dJZCwgY3VycmVudENhcklkKSB7XG4gICAgY29uc3QgY3VycmVudERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtdm9pdHVyZS1zZWN0aW9uJyk7XG4gICAgY29uc3QgYWRkVm9pdHVyZUZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZC12b2l0dXJlLWZvcm1cIik7XG4gICAgY29uc3QgYWRkVm9pdHVyZUZvcm1JbnB1dHMgPSBhZGRWb2l0dXJlRm9ybS5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScpO1xuXG4gICAgY2hlY2tJbnB1dHMoYWRkVm9pdHVyZUZvcm0pO1xuICAgIGFkZFZvaXR1cmVGb3JtSW5wdXRzLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IGNoZWNrSW5wdXRzKGFkZFZvaXR1cmVGb3JtKSlcbiAgICB9KTtcblxuICAgIGNvbnN0IGJhY2tCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXZvaXR1cmUtYmFjay1idG4nKTtcblxuICAgIGJhY2tCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkLXZvaXR1cmUtc2VjdGlvbicpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGl2VG9TaG93SWQpLnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcbiAgICB9KVxuXG4gICAgY29uc3QgaW1tYXRyaWN1bGF0aW9uSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWRkX3ZvaXR1cmVfaW1tYXRyaWN1bGF0aW9uJylcbiAgICBpbW1hdHJpY3VsYXRpb25JbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKGUua2V5ID09PSAnICcpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2VsZWN0Q29sb3JJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGRfdm9pdHVyZV9jb3VsZXVyJyk7XG4gICAgY29uc3QgY29sb3JJbmRpY2F0b3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29sb3ItdmlldycpO1xuXG4gICAgY29uc3QgY29sb3JNYXAgPSB7XG4gICAgICAgICdCbGFuYyc6ICcjZmZmZmZmJyxcbiAgICAgICAgJ05vaXInOiAnIzAwMDAwMCcsXG4gICAgICAgICdHcmlzIGZvbmPDqSc6ICcjNTU1NTU1JyxcbiAgICAgICAgJ0dyaXMgY2xhaXInOiAnI2QzZDNkMycsXG4gICAgICAgICdSb3VnZSc6ICcjZmYwMDAwJyxcbiAgICAgICAgJ0JsZXUnOiAnIzAwMDBmZicsXG4gICAgICAgICdWZXJ0JzogJyMwMDgwMDAnLFxuICAgICAgICAnSmF1bmUnOiAnI2ZmZmYwMCcsXG4gICAgICAgICdPcmFuZ2UnOiAnI2ZmYTUwMCcsXG4gICAgICAgICdNYXJyb24nOiAnIzhiNDUxMycsXG4gICAgICAgICdWaW9sZXQnOiAnIzgwMDA4MCcsXG4gICAgICAgICdCZWlnZSc6ICcjZjVmNWRjJyxcbiAgICAgICAgJ1Jvc2UnOiAnI2ZmYzBjYicsXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbG9yKCkge1xuICAgICAgICBjb25zdCBzZWxlY3RlZCA9IHNlbGVjdENvbG9ySW5wdXQudmFsdWU7XG5cbiAgICAgICAgaWYgKHNlbGVjdGVkID09PSAnJykgeyAvL3N0eWxlIHBsYWNlaG9sZGVyXG4gICAgICAgICAgICBzZWxlY3RDb2xvcklucHV0LmNsYXNzTGlzdC5hZGQoJ3NlbGVjdC1jb2xvci1wbGFjZWhvbGRlcicpOyBcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZWN0Q29sb3JJbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3QtY29sb3ItcGxhY2Vob2xkZXInKTtcbiAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvL3N0eWxlIGNvbG9yIGluZGljYXRvclxuICAgICAgICBjb2xvckluZGljYXRvci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvck1hcFtzZWxlY3RlZF0gfHwgJ3RyYW5zcGFyZW50JztcbiAgICB9XG5cbiAgICBzZWxlY3RDb2xvcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHVwZGF0ZUNvbG9yKTtcbiAgICB1cGRhdGVDb2xvcigpOyAvLyBpbml0aWFsaXNlIGF1IGNoYXJnZW1lbnRcblxuICAgIGNvbnN0IHBsYWNlc0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FkZF92b2l0dXJlX3BsYWNlcycpXG4gICAgcGxhY2VzSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc3QgbWF4U2VhdHMgPSA5O1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHBhcnNlSW50KHRoaXMudmFsdWUsIDEwKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChpc05hTih2YWx1ZSkpIHJldHVybjtcblxuICAgICAgICBpZiAodmFsdWUgPCAyKSB7XG4gICAgICAgIHBsYWNlc0lucHV0LnZhbHVlID0gMjtcbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+IG1heFNlYXRzKSB7XG4gICAgICAgIHBsYWNlc0lucHV0LnZhbHVlID0gbWF4U2VhdHM7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIFxuICAgIGNvbnN0IHNob3dEZWxldGVWb2l0dXJlUG9wdXBCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2hvdy1kZWxldGUtdm9pdHVyZS1wb3B1cCcpO1xuXG5cblxuICAgIGlmIChzaG93RGVsZXRlVm9pdHVyZVBvcHVwQnRuKSB7XG4gICAgICAgIGNvbnN0IGRlbGV0ZVZvaXR1cmVQb3B1cCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWxldGUtdm9pdHVyZS1wb3B1cCcpO1xuICAgICAgICBjb25zdCBkZWxldGVWb2l0dXJlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZS12b2l0dXJlJyk7XG4gICAgICAgIGNvbnN0IGFkZFZvaXR1cmVGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGQtdm9pdHVyZS1mb3JtXCIpO1xuXG4gICAgICAgIHNob3dEZWxldGVWb2l0dXJlUG9wdXBCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHNob3dQb3B1cChkZWxldGVWb2l0dXJlUG9wdXAsICdmbGV4Jyk7XG4gICAgICAgIH0pXG5cbiAgICAgICAgZGVsZXRlVm9pdHVyZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBcbiAgICAgICAgICAgIGZldGNoKCdkZWxldGUtdm9pdHVyZS8nICsgY3VycmVudENhcklkLCB7XG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgJ1gtUmVxdWVzdGVkLVdpdGgnOiAnWE1MSHR0cFJlcXVlc3QnXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyZXVyIEhUVFAgOiAnICsgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEuc3RhdHVzICYmIGRhdGEuc3RhdHVzID09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRpdlRvU2hvd0lkKS5zdHlsZS5kaXNwbGF5PVwiZmxleFwiO1xuICAgIFxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjdXJyZW50Q2FySWQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50RGl2LnN0eWxlLmRpc3BsYXk9XCJub25lXCI7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBzaG93U3VjY2Vzc0FsZXJ0KCdWb2l0dXJlIHN1cHByaW3DqSBhdmVjIHN1Y2PDqHMnKTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGluaXRVc2VyVm9pdHVyZUJ0bnMoZGl2VG9TaG93SWQsY3VycmVudENhcklkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0cmVhdEZvcm1BbGVydChhZGRWb2l0dXJlRm9ybSwgJycsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICBoaWRlUG9wdXAoZGVsZXRlVm9pdHVyZVBvcHVwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgICAgfSlcbiAgICBcbiAgICAgICAgfSlcbiAgICB9XG4gICAgXG5cbiAgICBjb25zdCBzdWJtaXRBZGRWb2l0dXJlRm9ybUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtdm9pdHVyZS1zdWJtaXQnKTtcblxuICAgIHN1Ym1pdEFkZFZvaXR1cmVGb3JtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRyZWF0QWRkVm9pdHVyZUZvcm0oZGl2VG9TaG93SWQsIGN1cnJlbnRDYXJJZCk7XG4gICAgfSlcbn1cblxuZnVuY3Rpb24gdHJlYXRBZGRWb2l0dXJlRm9ybShkaXZUb1Nob3dJZCwgY3VycmVudENhcklkID0gbnVsbCkge1xuICAgIGNvbnN0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZC12b2l0dXJlLWZvcm1cIik7XG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7XG4gICAgY29uc3QgY3VycmVudERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtdm9pdHVyZS1zZWN0aW9uJyk7XG5cbiAgICBjb25zdCBmZXRjaFBhdGggPSBjdXJyZW50Q2FySWRcbiAgICAgICAgPyBgL2FkZC12b2l0dXJlP2lkPSR7ZW5jb2RlVVJJQ29tcG9uZW50KGN1cnJlbnRDYXJJZCl9YFxuICAgICAgICA6IFwiL2FkZC12b2l0dXJlXCI7XG4gICAgXG4gICAgXG4gICAgZmV0Y2goZmV0Y2hQYXRoLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBib2R5OiBmb3JtRGF0YSxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICdYLVJlcXVlc3RlZC1XaXRoJzogJ1hNTEh0dHBSZXF1ZXN0J1xuICAgICAgICB9XG4gICAgfSlcbiAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXJyZXVyIEhUVFAgOiAnICsgcmVzcG9uc2Uuc3RhdHVzKTtcblxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSlcbiAgICAudGhlbihkYXRhID0+IHtcbiAgICAgICAgaWYgKGRhdGEuc3RhdHVzICYmIGRhdGEuc3RhdHVzID09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkaXZUb1Nob3dJZCkuc3R5bGUuZGlzcGxheT1cImZsZXhcIjtcbiAgICAgICAgICAgIGN1cnJlbnREaXYuc3R5bGUuZGlzcGxheT1cIm5vbmVcIjtcblxuICAgICAgICAgICAgY29uc3Qgdm9pdHVyZXNMaXN0RGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItdm9pdHVyZXMnKTtcblxuICAgICAgICAgICAgaWYgKCFjdXJyZW50Q2FySWQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWb2l0dXJlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICAgICAgbmV3Vm9pdHVyZURpdi5jbGFzc0xpc3QuYWRkKFwidm9pdHVyZS1jYXJkXCIpO1xuICAgICAgICAgICAgICAgIG5ld1ZvaXR1cmVEaXYuaWQgPSBkYXRhLnZvaXR1cmUuaWQ7XG5cbiAgICAgICAgICAgICAgICBuZXdWb2l0dXJlRGl2LmlubmVySFRNTCA9IGBcbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJzdXJub21cIj4ke2RhdGEudm9pdHVyZS5zdXJub219PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtYXJxdWVcIj4ke2RhdGEudm9pdHVyZS5tYXJxdWV9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJtb2RlbGVcIj4ke2RhdGEudm9pdHVyZS5tb2RlbGV9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpcy1lbGVjdHJpY1wiPiR7ZGF0YS52b2l0dXJlLmlzRWxlY3RyaWMgPyAnRWxlY3RyaXF1ZScgOiAnVGhlcm1pcXVlJ308L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInBsYWNlcyBmdy1ib2xkXCI+JHtkYXRhLnZvaXR1cmUucGxhY2VzfSBwbGFjZSR7ZGF0YS52b2l0dXJlLnBsYWNlcyA+IDEgPyAncycgOiAnJ308L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIGBcblxuICAgICAgICAgICAgICAgIHZvaXR1cmVzTGlzdERpdi5pbnNlcnRBZGphY2VudEVsZW1lbnQoJ2FmdGVyYmVnaW4nLG5ld1ZvaXR1cmVEaXYpO1xuICAgICAgICAgICAgICAgIHNob3dTdWNjZXNzQWxlcnQoJ1ZvaXR1cmUgYWpvdXTDqSBhdmVjIHN1Y2PDqHMnKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50Vm9pdHVyZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGN1cnJlbnRDYXJJZCk7XG5cbiAgICAgICAgICAgICAgICBjdXJyZW50Vm9pdHVyZURpdi5pbm5lckhUTUwgPSBgXG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwic3Vybm9tXCI+JHtkYXRhLnZvaXR1cmUuc3Vybm9tfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibWFycXVlXCI+JHtkYXRhLnZvaXR1cmUubWFycXVlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwibW9kZWxlXCI+JHtkYXRhLnZvaXR1cmUubW9kZWxlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaXMtZWxlY3RyaWNcIj4ke2RhdGEudm9pdHVyZS5pc0VsZWN0cmljID8gJ0VsZWN0cmlxdWUnIDogJ1RoZXJtaXF1ZSd9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJwbGFjZXMgZnctYm9sZFwiPiR7ZGF0YS52b2l0dXJlLnBsYWNlc30gcGxhY2Uke2RhdGEudm9pdHVyZS5wbGFjZXMgPiAxID8gJ3MnIDogJyd9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICBgO1xuXG4gICAgICAgICAgICAgICAgc2hvd1N1Y2Nlc3NBbGVydCgnVm9pdHVyZSBtb2RpZmnDqSBhdmVjIHN1Y2PDqHMnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaW5pdFVzZXJWb2l0dXJlQnRucyhkaXZUb1Nob3dJZCwgY3VycmVudENhcklkKTtcblxuXG4gICAgICAgICAgICAvL2xpZ25lcyBkZSBjb2RlIGFwcGxpY2FibGUgYSBsYSBwYWdlIGRldmVuaXIgY2hhdWZmZXVyXG4gICAgICAgICAgICBjb25zdCBoYXNWb2l0dXJlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV2ZW5pcl9jaGF1ZmZldXJfaGFzVm9pdHVyZScpO1xuICAgICAgICAgICAgY29uc3Qgdm9pdHVyZUNhcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnZvaXR1cmUtY2FyZCcpO1xuXG4gICAgICAgICAgICBpZiAoaGFzVm9pdHVyZUlucHV0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHZvaXR1cmVDYXJkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhc1ZvaXR1cmVJbnB1dC5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaGFzVm9pdHVyZUlucHV0LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdpbnB1dCcsIHsgYnViYmxlczogdHJ1ZSB9KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvL2FwcGxpcXVlciBmb25jdGlvbiBKUyBwb3VyIHNlbGVjdGlvblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFBhcmVudERpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib2R5LWNvbnRlbnQnKTtcblxuICAgICAgICAgICAgY3VycmVudERpdi5yZW1vdmUoKTtcbiAgICAgICAgICAgIGN1cnJlbnRQYXJlbnREaXYuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLGRhdGEuaHRtbCk7XG4gICAgICAgICAgICBpbml0QWRkVm9pdHVyZUZvcm1CdG5zKGRpdlRvU2hvd0lkLCBjdXJyZW50Q2FySWQpO1xuICAgICAgICAgICAgaW5pdE1hcnF1ZUlucHV0SW50ZXJhY3Rpb24oKTtcbiAgICAgICAgfVxuICAgIH0pXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0VXNlclZvaXR1cmVCdG5zKGRpdlRvU2hvd0lkLCBjdXJyZW50Q2FySWQgPSBudWxsKSB7XG4gICAgY29uc3QgdXNlclZvaXR1cmVzQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudm9pdHVyZS1jYXJkXCIpO1xuICAgIGNvbnN0IHZvaXR1cmVJbnB1dCA9ICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudm9pdHVyZS1pbnB1dCcpO1xuXG4gICAgaWYgKCFjdXJyZW50Q2FySWQpIHtcbiAgICAgICAgdXNlclZvaXR1cmVzQnRucy5mb3JFYWNoKHZvaXR1cmVCdG4gPT4ge1xuICAgICAgICAgICAgaWYgKHZvaXR1cmVCdG4uZGF0YXNldC5saXN0ZW5lckF0dGFjaGVkID09PSAndHJ1ZScpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47IC8vIE5lIHJpZW4gZmFpcmUgc2kgZMOpasOgIGF0dGFjaMOpXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHZvaXR1cmVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICBjb25zdCBjdXJyZW50Vm9pdHVyZUlkID0gdm9pdHVyZUJ0bi5pZDtcbiAgICAgICAgICAgICAgdXNlclZvaXR1cmVzQnRucy5mb3JFYWNoKHZvaXR1cmVCdG4gPT4gdm9pdHVyZUJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdzZWxlY3RlZCcpKTtcblxuXG4gICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgdm9pdHVyZUlucHV0LnZhbHVlID0gY3VycmVudFZvaXR1cmVJZDtcbiAgICAgICAgICAgICAgLy9kZWNsZW5jaGUgZXZlbnQgc3VyIHZvaXR1cmUgbWFudWVsbGVtZW50XG4gICAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEV2ZW50KFwiaW5wdXRcIiwgeyBidWJibGVzOiB0cnVlIH0pO1xuICAgICAgICAgICAgICB2b2l0dXJlSW5wdXQuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBpZiAoIXdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCdwdWJsaWVyLXRyYWpldCcpKSB7XG4gICAgICAgICAgICAgICAgc2hvd0FkZFZvaXR1cmVGb3JtKGRpdlRvU2hvd0lkLCB2b2l0dXJlQnRuLmlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgdm9pdHVyZUJ0bi5kYXRhc2V0Lmxpc3RlbmVyQXR0YWNoZWQgPSAndHJ1ZSc7XG4gICAgICAgIFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KVxuICAgIH0gXG4gIFxuICAgIFxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2hvd0FkZFZvaXR1cmVGb3JtKGRpdlRvSGlkZUlkLCBjdXJyZW50Q2FySWQgPSBudWxsKSB7XG4gICAgY29uc3QgYWRkVm9pdHVyZURpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtdm9pdHVyZS1zZWN0aW9uJyk7XG5cbiAgICBpZiAoYWRkVm9pdHVyZURpdikge1xuICAgICAgICBhZGRWb2l0dXJlRGl2LnJlbW92ZSgpO1xuICAgIH1cbiAgICBcbiAgICBhZGRWb2l0dXJlKGRpdlRvSGlkZUlkLCBjdXJyZW50Q2FySWQpO1xuICAgICAgICBcbiAgICBcblxuXG59Il0sIm5hbWVzIjpbImNoZWNrSW5wdXRzIiwiaGlkZVBvcHVwIiwic2hvd0Vycm9ycyIsInNob3dQb3B1cCIsInRyZWF0Rm9ybUFsZXJ0Iiwic2hvd1N1Y2Nlc3NBbGVydCIsImFkZFZvaXR1cmUiLCJwcmV2aW91c0VsZW1lbnRJZCIsImN1cnJlbnRDYXJJZCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImZldGNoUGF0aCIsImNvbmNhdCIsImVuY29kZVVSSUNvbXBvbmVudCIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJkYXRhIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiZGlzcGxheSIsImNvbnRhaW5lciIsImluc2VydEFkamFjZW50SFRNTCIsImh0bWwiLCJpbml0TWFycXVlSW5wdXRJbnRlcmFjdGlvbiIsImluaXRBZGRWb2l0dXJlRm9ybUJ0bnMiLCJjdXJyZW50Vm9pdHVyZSIsInZhbHVlIiwicXVlcnlTZWxlY3RvciIsImlubmVySFRNTCIsImNvbnNvbGUiLCJlcnJvciIsIm1hcnF1ZUlucHV0Iiwic3VnZ2VzdGlvbnNCb3giLCJicmFuZHMiLCJKU09OIiwicGFyc2UiLCJkYXRhc2V0IiwibWFycXVlTGlzdCIsInNlbGVjdGVkIiwiYWRkRXZlbnRMaXN0ZW5lciIsInF1ZXJ5IiwidG9Mb3dlckNhc2UiLCJmaWx0ZXJlZCIsImZpbHRlciIsImJyYW5kIiwiaW5jbHVkZXMiLCJzbGljZSIsImZvckVhY2giLCJsaSIsImNyZWF0ZUVsZW1lbnQiLCJ0ZXh0Q29udGVudCIsImN1cnNvciIsIm9uY2xpY2siLCJhcHBlbmRDaGlsZCIsImRpdlRvU2hvd0lkIiwiY3VycmVudERpdiIsImFkZFZvaXR1cmVGb3JtIiwiYWRkVm9pdHVyZUZvcm1JbnB1dHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaW5wdXQiLCJiYWNrQnRuIiwiZSIsImltbWF0cmljdWxhdGlvbklucHV0Iiwia2V5IiwicHJldmVudERlZmF1bHQiLCJzZWxlY3RDb2xvcklucHV0IiwiY29sb3JJbmRpY2F0b3IiLCJjb2xvck1hcCIsInVwZGF0ZUNvbG9yIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiYmFja2dyb3VuZENvbG9yIiwicGxhY2VzSW5wdXQiLCJtYXhTZWF0cyIsInBhcnNlSW50IiwiaXNOYU4iLCJzaG93RGVsZXRlVm9pdHVyZVBvcHVwQnRuIiwiZGVsZXRlVm9pdHVyZVBvcHVwIiwiZGVsZXRlVm9pdHVyZUJ0biIsIm9rIiwiRXJyb3IiLCJzdGF0dXMiLCJpbml0VXNlclZvaXR1cmVCdG5zIiwic3VibWl0QWRkVm9pdHVyZUZvcm1CdG4iLCJ0cmVhdEFkZFZvaXR1cmVGb3JtIiwiZm9ybSIsImZvcm1EYXRhIiwiRm9ybURhdGEiLCJib2R5Iiwidm9pdHVyZXNMaXN0RGl2IiwibmV3Vm9pdHVyZURpdiIsImlkIiwidm9pdHVyZSIsInN1cm5vbSIsIm1hcnF1ZSIsIm1vZGVsZSIsImlzRWxlY3RyaWMiLCJwbGFjZXMiLCJpbnNlcnRBZGphY2VudEVsZW1lbnQiLCJjdXJyZW50Vm9pdHVyZURpdiIsImhhc1ZvaXR1cmVJbnB1dCIsInZvaXR1cmVDYXJkcyIsImNoZWNrZWQiLCJkaXNwYXRjaEV2ZW50IiwiRXZlbnQiLCJidWJibGVzIiwiY3VycmVudFBhcmVudERpdiIsInVzZXJWb2l0dXJlc0J0bnMiLCJ2b2l0dXJlSW5wdXQiLCJ2b2l0dXJlQnRuIiwibGlzdGVuZXJBdHRhY2hlZCIsImN1cnJlbnRWb2l0dXJlSWQiLCJldmVudCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsInNob3dBZGRWb2l0dXJlRm9ybSIsImRpdlRvSGlkZUlkIiwiYWRkVm9pdHVyZURpdiJdLCJzb3VyY2VSb290IjoiIn0=